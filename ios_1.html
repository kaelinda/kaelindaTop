<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	iOS - kaelinda
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="kaelinda" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}
	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
				 
				 	<div class="profilepic">
						<img src="https://ws1.sinaimg.cn/large/006tNc79ly1fmpk9088gsj30sg0sgn33.jpg" style="width:160px;">
					</div>
            	
					
					<h1><a href="index.html">kaelinda</a></h1>
					<p class="subtitle">倘若我心中的山水，你眼中能看到，我便一步一莲花祈祷</p>
					<nav id="main-nav">
						<ul class="main">
						
						  <li id=""><a target="_self" href="index.html">最近更新</a></li>
						
						  <li id=""><a target="_self" href="archives.html">归档目录</a></li>
						
						  <li id="ios.css"><a target="_self" href="ios.html">iOS</a></li>
						
						  <li id="swift.css"><a target="_self" href="swift.html">Swift</a></li>
						
						  <li id="reactnative.css"><a target="_self" href="reactnative.html">RN</a></li>
						
						  <li id="js.css"><a target="_self" href="js.html">JS</a></li>
						
						  <li id="shell.css"><a target="_self" href="shell.html">shell</a></li>
						
						  <li id="py.css"><a target="_self" href="py.html">Python</a></li>
						
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">










<a target="_blank" class="github" target="_blank" href="https://github.com/Kaelzzs" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:zhouzuosong_kael@163.com" title="Email">Email</a>

								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T11:07:43+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336624630931.html" itemprop="url">
		iOS 之 APP安全</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2><a id="%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87%E6%98%AF%E5%90%A6%E8%B6%8A%E7%8B%B1" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>检测设备是否越狱</h2>
<pre><code class="language-plain_text">+ (BOOL)isJailBreak {
	if ([[NSFileManager defaultManager] fileExistsAtPath:@&quot;/Applications/Cydia.app&quot;]){
		return YES;
	}
	
	if ([[NSFileManager defaultManager] fileExistsAtPath:@&quot;/Library/MobileSubstrate/MobileSubstrate.dylib&quot;]){
		return YES;
	}
	
	if ([[NSFileManager defaultManager] fileExistsAtPath:@&quot;/bin/bash&quot;]){
		return YES;
	}
	
	if ([[NSFileManager defaultManager] fileExistsAtPath:@&quot;/usr/sbin/sshd&quot;]){
		return YES;
	}
	
	if ([[NSFileManager defaultManager] fileExistsAtPath:@&quot;/etc/apt&quot;]){
		return YES;
	}
	if ([[UIApplication sharedApplication] canOpenURL:[NSURL URLWithString:@&quot;cydia://&quot;]]) {
		return YES;
	}
	return NO;
}
</code></pre>
<h2><a id="%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E4%BB%A3%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>检测设备网络环境是否开启代理</h2>
<pre><code class="language-plain_text">NSDictionary *proxySettings = (__bridge NSDictionary *)(CFNetworkCopySystemProxySettings());
NSArray *proxies = (__bridge NSArray *)(CFNetworkCopyProxiesForURL((__bridge CFURLRef _Nonnull)([NSURL URLWithString:@&quot;https://www.baidu.com&quot;]), (__bridge CFDictionaryRef _Nonnull)(proxySettings)));

NSLog(@&quot;\n%@&quot;,proxies);
NSDictionary *settings = proxies[0];
NSLog(@&quot;%@&quot;,[settings objectForKey:(NSString *)kCFProxyHostNameKey]);
NSLog(@&quot;%@&quot;,[settings objectForKey:(NSString *)kCFProxyPortNumberKey]);
NSLog(@&quot;%@&quot;,[settings objectForKey:(NSString *)kCFProxyTypeKey]);
    if ([[settings objectForKey:(NSString *)kCFProxyTypeKey] isEqualToString:@&quot;kCFProxyTypeNone&quot;])
    {
        NSLog(@&quot;kael 没代理&quot;);
    }
                                                                                                     else
    {
        NSLog(@&quot;kael 设置了代理&quot;);
    }
</code></pre>
<h2><a id="app%E7%A6%81%E6%AD%A2%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>APP 禁止动态调试</h2>
<pre><code class="language-plain_text">#import &lt;UIKit/UIKit.h&gt; 
#import &quot;AppDelegate.h&quot;  
#import &lt;dlfcn.h&gt;

typedef int (*ptrace_ptr_t)(int _request, pid_t _pid, caddr_t _addr, int _data);
#if !defined(PT_DENY_ATTACH)
#define PT_DENY_ATTACH 31
#endif  // !defined(PT_DENY_ATTACH)

void disable_gdb() {
  void* handle = dlopen(0, RTLD_GLOBAL | RTLD_NOW);
  ptrace_ptr_t ptrace_ptr = dlsym(handle, &quot;ptrace&quot;);
  ptrace_ptr(PT_DENY_ATTACH, 0, 0, 0);
  dlclose(handle);
}

int main(int argc, char * argv[]) {
#ifndef DEBUG
    disable_gdb();
#endif
    @autoreleasepool {
        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));
    }
}
</code></pre>
<p>如果你在Xcode调试环境下，去掉#ifndef DEBUG #endif这句话，你会发现，Xcode无法调试该应用；因为动态的加载了ptrace，然后给传输的宏是PT_DENY_ATTACH 拒绝附加进程</p>
<h2><a id="%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86%E8%84%9A%E6%9C%AC" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>代码混淆 脚本</h2>
<p><a href="https://zfj1128.blog.csdn.net/article/details/95482006">代码混淆相关 参考文章</a></p>
<pre><code class="language-plain_text">TABLENAME=symbols
SYMBOL_DB_FILE=&quot;$PROJECT_DIR/CodeObfuscation/symbols&quot;
STRING_SYMBOL_FILE=&quot;$PROJECT_DIR/CodeObfuscation/func.list&quot;
HEAD_FILE=&quot;$PROJECT_DIR/CodeObfuscation/codeObfuscation.h&quot;
export LC_CTYPE=C

#维护数据库方便日后作排重
createTable()
{
echo &quot;create table $TABLENAME(src text, des text);&quot; | sqlite3 $SYMBOL_DB_FILE
}

insertValue()
{
echo &quot;insert into $TABLENAME values('$1' ,'$2');&quot; | sqlite3 $SYMBOL_DB_FILE
}

query()
{
echo &quot;select * from $TABLENAME where src='$1';&quot; | sqlite3 $SYMBOL_DB_FILE
}

ramdomString()
{
openssl rand -base64 64 | tr -cd 'a-zA-Z' |head -c 16
}

rm -f $SYMBOL_DB_FILE
rm -f $HEAD_FILE
createTable

touch $HEAD_FILE
echo '#ifndef Demo_codeObfuscation_h
#define Demo_codeObfuscation_h' &gt;&gt; $HEAD_FILE
echo &quot;//confuse string at `date`&quot; &gt;&gt; $HEAD_FILE
cat &quot;$STRING_SYMBOL_FILE&quot; | while read -ra line; do
if [[ ! -z &quot;$line&quot; ]]; then
ramdom=`ramdomString`
echo $line $ramdom
insertValue $line $ramdom
echo &quot;#define $line $ramdom&quot; &gt;&gt; $HEAD_FILE
fi
done
echo &quot;#endif&quot; &gt;&gt; $HEAD_FILE


sqlite3 $SYMBOL_DB_FILE .dump
</code></pre>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T11:06:24+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336623849036.html" itemprop="url">
		乐学高考APP 添加全屏侧滑手势</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2><a id="%E4%BE%A7%E6%BB%91%E6%89%8B%E5%8A%BF%E4%BC%9A%E5%BD%B1%E5%93%8D%E7%9A%84%E5%87%A0%E4%B8%AA%E7%82%B9%EF%BC%9A" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>侧滑手势会影响的几个点：</strong></h2>
<h3><a id="navigationbar%E7%9A%84%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>navigationBar的显示隐藏</h3>
<ul>
<li>
<p>根视图中</p>
<pre><code class="language-plain_text">// 设置默认触发边缘范围
self.fd_interactivePopMaxAllowedInitialDistanceToLeftEdge = 80;
</code></pre>
</li>
<li>
<p>需要特殊处理的控制器中：</p>
<pre><code class="language-plain_text">// 禁止or响应返回手势
self.popDisable = YES;
// 隐藏or显示navigationBar
self.lxPrefersNavigationBarHidden = YES;
</code></pre>
</li>
</ul>
<h3><a id="vc%E5%86%85%E5%8C%85%E5%90%ABscrollview%E5%8F%8A%E5%85%B6%E5%AD%90%E7%B1%BB%E6%9C%89%E6%89%8B%E5%8A%BF%E5%86%B2%E7%AA%81%E6%97%B6%E7%9A%84%E5%A4%84%E7%90%86%E3%80%90-typagercontroller%E3%80%91%E7%AD%89%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>VC内包含scrollView及其子类有手势冲突时的处理 【TYPagerController】等第三方库</h3>
<ul>
<li>
<p>解决方案一：</p>
<pre><code class="language-plain_text">  用`LXPopScrollView`、`LXPopTableView`、`LXPopCollectionView`替换原生的`UIScrollView`及其子类
</code></pre>
</li>
<li>
<p>解决方案二【推荐】：</p>
<pre><code class="language-plain_text">[ViewController lxAddPopGestureToView:self.scrollView];
</code></pre>
<p>子控制器中需要添加好几次，父控制器中只需要添加一次</p>
<pre><code class="language-plain_text">[self lxAddPopGestureToView:self.view];
</code></pre>
</li>
</ul>
<h3><a id="%E7%95%8C%E9%9D%A2%E5%9C%A8viewwillappear%E6%97%B6%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%88%B7%E6%96%B0%E6%95%B0%E6%8D%AE-loading" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>界面在viewwillappear时的网络请求刷新数据 + loading</h3>
<h2><a id="prefernavigationhidden%E5%B1%9E%E6%80%A7%E6%8E%A7%E5%88%B6%E5%AF%BC%E8%88%AA%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>preferNavigationHidden</code> 属性控制导航显示隐藏</h2>
<table>
<thead>
<tr>
<th>包含preferNavigationHidden属性的VC</th>
</tr>
</thead>
<tbody>
<tr>
<td>LXBaseViewController</td>
</tr>
<tr>
<td>LXStudyCenterViewController</td>
</tr>
<tr>
<td>LXMyCoursesChildController</td>
</tr>
<tr>
<td>LXStudyMyCoursesSubVC</td>
</tr>
<tr>
<td>LXQATopicPostListController</td>
</tr>
<tr>
<td>LXQAKnowledgeSquareController</td>
</tr>
<tr>
<td>LXQASubjectPostListController</td>
</tr>
<tr>
<td>LXQAPostListChildController</td>
</tr>
<tr>
<td>LXQATodayHotPostController</td>
</tr>
<tr>
<td>LXQACenterChildController</td>
</tr>
<tr>
<td>LXQAQuestionDetailController</td>
</tr>
<tr>
<td>LXQAAnswerDetailController</td>
</tr>
<tr>
<td>LXQATeacherDetailController</td>
</tr>
<tr>
<td>LXAnswerCenterController</td>
</tr>
<tr>
<td>LXMineViewController</td>
</tr>
<tr>
<td>LXPerfectUserInfoController</td>
</tr>
<tr>
<td><strong>TOWebViewController</strong></td>
</tr>
<tr>
<td>LXUserInfoGuiderController</td>
</tr>
<tr>
<td>LXGradeController</td>
</tr>
<tr>
<td>LXPrimaryGradesController</td>
</tr>
<tr>
<td>LXSubjectController</td>
</tr>
<tr>
<td>LiveClassroomViewController</td>
</tr>
<tr>
<td>LXAudioPlayerController</td>
</tr>
<tr>
<td>LXGoodsDetailsController</td>
</tr>
<tr>
<td>LXGoodsCouponListController</td>
</tr>
</tbody>
</table>
<h2><a id="setnavigationbarhidden%E6%96%B9%E5%BC%8F%E9%9A%90%E8%97%8F%E5%AF%BC%E8%88%AA%E6%9D%A1" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>setNavigationBarHidden</code> 方式隐藏导航条</h2>
<table>
<thead>
<tr>
<th>包含setNavigationBarHidden方式隐藏导航条的VC</th>
</tr>
</thead>
<tbody>
<tr>
<td>LXBaseViewController</td>
</tr>
<tr>
<td><strong>LXSearchViewController</strong> -- 搜索界面</td>
</tr>
<tr>
<td><strong>LXCourseDetailViewController</strong> -- 跳转智齿</td>
</tr>
<tr>
<td>LXMineViewController</td>
</tr>
<tr>
<td>LXFeedBackListController</td>
</tr>
<tr>
<td>FeedbackViewController</td>
</tr>
<tr>
<td>LXQuestionAlertController</td>
</tr>
<tr>
<td>LXClassNotesBrowserVC</td>
</tr>
<tr>
<td>TOWebViewController</td>
</tr>
<tr>
<td>LXGradeController</td>
</tr>
<tr>
<td>LXSubjectController</td>
</tr>
<tr>
<td><strong>LXPhotoBrowseViewController</strong></td>
</tr>
<tr>
<td>LXMyMessagesController</td>
</tr>
<tr>
<td>LXWebViewController</td>
</tr>
<tr>
<td>TZPhotoPreviewController</td>
</tr>
<tr>
<td>TZVideoPlayerController</td>
</tr>
<tr>
<td>TZGifPhotoPreviewController</td>
</tr>
</tbody>
</table>
<h2><a id="navigationcontroller-navigationbar-hidden-yes%E6%96%B9%E5%BC%8F%E9%9A%90%E8%97%8F%E5%AF%BC%E8%88%AA%E6%9D%A1" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>navigationController.navigationBar.hidden = YES</code>方式隐藏导航条</h2>
<table>
<thead>
<tr>
<th><code>navigationBar.hidden</code>属性方式隐藏导航条的VC</th>
</tr>
</thead>
<tbody>
<tr>
<td>LXViewControllertest</td>
</tr>
<tr>
<td>LXMuttiCourseDetailViewController</td>
</tr>
<tr>
<td>LXDiscoverViewController</td>
</tr>
<tr>
<td>LXHeadWearVC</td>
</tr>
<tr>
<td>LXPlayerViewController</td>
</tr>
<tr>
<td>LXTeacherDetailController</td>
</tr>
</tbody>
</table>
<h2><a id="%E5%8C%85%E5%90%AB%E5%BC%B9%E5%87%BA%E7%A7%91%E7%9B%AE%E9%80%89%E6%8B%A9%E9%81%AE%E7%BD%A9lxfilterbaseviewcontroller%E7%9A%84%E6%8E%A7%E5%88%B6%E5%99%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>包含弹出科目选择遮罩<code>LXFilterBaseViewController</code>的控制器</h2>
<p><img src="http://ww3.sinaimg.cn/large/006y8mN6ly1g67clftpsgj30oo0mado5.jpg" alt="科目弹出窗" /></p>
<table>
<thead>
<tr>
<th>包含弹出科目选择遮罩<code>LXFilterBaseViewController</code>的控制器</th>
</tr>
</thead>
<tbody>
<tr>
<td>LXTopicListViewController</td>
</tr>
<tr>
<td>LXFiveScoreListController</td>
</tr>
<tr>
<td>LXCommonlyListViewController</td>
</tr>
<tr>
<td>LXPurchasedCoursesController</td>
</tr>
<tr>
<td>LXExperienceClassController</td>
</tr>
</tbody>
</table>
<h2><a id="tab%E5%88%87%E6%8D%A2scrollview%E5%81%8F%E7%A7%BB%E9%87%8F%E5%88%87%E6%8D%A2%E9%A1%B5%E9%9D%A2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>tab切换scrollview偏移量切换页面</h2>
<p>请参考 解决方案二</p>
<pre><code class="language-plain_text">[ViewController lxAddPopGestureToView:self.scrollView];
</code></pre>
<p>子控制器中需要添加好几次，父控制器中只需要添加一次
<code>[self lxAddPopGestureToView:self.view];</code></p>
<hr />
<p><img src="http://ww3.sinaimg.cn/large/006y8mN6ly1g67cksphthj30ok0z87gl.jpg" alt="不定位置tab" />
<img src="http://ww1.sinaimg.cn/large/006y8mN6ly1g67ck1uq5oj30og0w4don.jpg" alt="顶部tab" /></p>
<h3><a id="zjscrollpageview" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ZJScrollPageView</h3>
<table>
<thead>
<tr>
<th>使用ZJScrollPageView</th>
</tr>
</thead>
<tbody>
<tr>
<td>LXHomeViewController</td>
</tr>
<tr>
<td>LXSubjectRecordListVC</td>
</tr>
<tr>
<td>LXHomeRecommendVC</td>
</tr>
<tr>
<td>LXMyCouponController</td>
</tr>
</tbody>
</table>
<h3><a id="tytabpagercontroller" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>TYTabPagerController</h3>
<table>
<thead>
<tr>
<th>TYTabPagerController</th>
</tr>
</thead>
<tbody>
<tr>
<td>LXMyMessagesController</td>
</tr>
<tr>
<td>LXOrderListController</td>
</tr>
<tr>
<td>LXResourceListController</td>
</tr>
<tr>
<td>LXHotSingleCourseViewController</td>
</tr>
</tbody>
</table>
<h3><a id="fspagecontentview" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>FSPageContentView</h3>
<table>
<thead>
<tr>
<th>FSPageContentView</th>
</tr>
</thead>
<tbody>
<tr>
<td>LXTeacherDetailController</td>
</tr>
<tr>
<td>LXProductDetailController</td>
</tr>
<tr>
<td>LXSeckillDatailController</td>
</tr>
</tbody>
</table>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T11:05:48+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336623484572.html" itemprop="url">
		iOS 图表工具</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2><a id="ios-echarts" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>iOS-Echarts</h2>
<p><a href="https://www.jianshu.com/p/3d5fe1f4693d">iOS-Echarts 参考文章</a></p>
<ul>
<li>基于js，让WebView加载、渲染UI</li>
</ul>
<h2><a id="ios-charts" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ios-charts</h2>
<p>MPAndroidChart 在iOS系统上面的移植</p>
<ul>
<li>用的swift编写，需要在现有OC项目中创建桥接文件 比较笨重</li>
</ul>
<p><a href="https://cloud.tencent.com/developer/article/1336386">ios-charts使用参考文章</a></p>
<p><a href="https://www.jianshu.com/p/94cdcc08d1ae">安卓iOS 通用教程</a></p>
<h2><a id="github%E4%B8%8A%E4%BC%98%E7%A7%80%E7%9A%84oc%E5%9B%BE%E6%A0%87%E5%BA%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>GitHub上优秀的OC图标库</h2>
<p><a href="https://github.com/search?l=Objective-C&amp;o=desc&amp;q=chart&amp;s=stars&amp;type=Repositories">GitHub上优秀的OC图标库</a></p>
<p><a href="https://github.com/search?l=Java&amp;o=desc&amp;q=chart&amp;s=stars&amp;type=Repositories">GitHub上优秀的java图标库</a></p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T11:05:11+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336623112375.html" itemprop="url">
		iOS13适配注意事项</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>技术参考：</p>
<p><a href="https://developer.apple.com/design/human-interface-guidelines/sign-in-with-apple/overview/">apple login</a></p>
<p><a href="https://www.jianshu.com/p/46cd57b98b0d">IOS13适配-详细</a></p>
<p><a href="https://www.jianshu.com/p/373a8fb3b345">iOS 13 适配(持续更新中)</a></p>
<p><a href="https://www.jianshu.com/p/4654f8f6e16e">iOS13适配</a></p>
<p><a href="https://juejin.im/post/5d745f8af265da03b5746fa0">掘金 iOS 13适配01</a></p>
<p><a href="https://juejin.im/post/5d00af64e51d455d88219ee2#heading-8">掘金  适配 iOS13</a></p>
<p><a href="https://github.com/ChenYilong/iOS13AdaptationTips/issues?q=is%3Aissue+is%3Aopen+label%3Anote">iOS 13 更新tips</a></p>
<p><a href="https://medium.com/@hacknicity/view-controller-presentation-changes-in-ios-13-ac8c901ebc4e">View Controller Presentation Changes in iOS 13</a></p>
<h2><a id="1-apple-login%EF%BC%88-2020%E5%B9%B44%E6%9C%88%E4%BB%BD%EF%BC%89" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Apple Login （2020年4月份）</h2>
<p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdocs-assets.developer.apple.com%2Fpublished%2F80ac09c84c%2FAddingTheSignInWithAppleFlowToYourApp.zip">附上官方Demo：下载地址</a></p>
<h2><a id="2-dark-mode" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Dark Mode</h2>
<h3><a id="2-1%E6%9A%97%E9%BB%91%E6%A8%A1%E5%BC%8F%E7%8A%B6%E6%80%81%E5%88%A4%E6%96%AD%E5%88%87%E6%8D%A2%E7%9B%91%E5%90%AC" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.1 暗黑模式 状态判断 &amp;&amp; 切换监听</h3>
<ul>
<li>判断模式状态</li>
</ul>
<pre><code class="language-plain_text">if (UITraitCollection.currentTraitCollection.userInterfaceStyle == UIUserInterfaceStyleDark) {
    // 暗黑模式
}
else {
    // 正常模式
}
</code></pre>
<ul>
<li>监听模式切换</li>
</ul>
<pre><code class="language-plain_text">// 注意:参数为变化前的traitCollection
- (void)traitCollectionDidChange:(UITraitCollection *)previousTraitCollection;

// 判断两个UITraitCollection对象是否不同
- (BOOL)hasDifferentColorAppearanceComparedToTraitCollection:(UITraitCollection *)traitCollection;
</code></pre>
<h3><a id="2-2%E7%A6%81%E7%94%A8%E6%9A%97%E9%BB%91%E6%A8%A1%E5%BC%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2 禁用暗黑模式</h3>
<ul>
<li>
<p>info.plist 内APP级别禁用暗黑模式</p>
<p>Key: <code>User Interface Style</code>
value: <code>Light</code></p>
</li>
<li>
<p>widow级别的禁用暗黑模式</p>
<pre><code class="language-plain_text">if (@available(iOS 13.0, *)) {
    [UIApplication sharedApplication].keyWindow.overrideUserInterfaceStyle = UIUserInterfaceStyleLight;
}
</code></pre>
</li>
<li>
<p>ViewController级别禁用暗黑模式</p>
<p>想全局禁用需要在 baseVC内全局禁用</p>
<pre><code class="language-plain_text">#if defined(__IPHONE_13_0) &amp;&amp; __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= __IPHONE_13_0
- (UIUserInterfaceStyle)overrideUserInterfaceStyle{
    return UIUserInterfaceStyleLight;
}
#endif
</code></pre>
</li>
<li>
<p>view级别禁用暗黑模式</p>
<pre><code class="language-plain_text">view.overrideUserInterfaceStyle = UIUserInterfaceStyleLight;
</code></pre>
</li>
</ul>
<h3><a id="2-3%E9%80%82%E9%85%8D%E6%9A%97%E9%BB%91%E6%A8%A1%E5%BC%8F%E9%A2%9C%E8%89%B2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.3 适配暗黑模式颜色</h3>
<p><a href="https://www.jianshu.com/p/7925bd51d2d6">参考这里 ：iOS开发如何适配暗黑模式（Dark Mode）</a></p>
<pre><code class="language-plain_text">+ (UIColor *)colorWithDynamicProvider:(UIColor * (^)(UITraitCollection *))dynamicProvider API_AVAILABLE(ios(13.0), tvos(13.0)) API_UNAVAILABLE(watchos);
- (UIColor *)initWithDynamicProvider:(UIColor * (^)(UITraitCollection *))dynamicProvider API_AVAILABLE(ios(13.0), tvos(13.0)) API_UNAVAILABLE(watchos);
</code></pre>
<pre><code class="language-plain_text">[UIColor colorWithDynamicProvider:^UIColor * _Nonnull(UITraitCollection * _Nonnull trait) {
    if (trait.userInterfaceStyle == UIUserInterfaceStyleDark) {
        return UIColorRGB(0x000000);
    } else {
        return UIColorRGB(0xFFFFFF);
    }
 }];
</code></pre>
<h2><a id="3-present%E5%8D%8A%E5%B1%8F%E9%97%AE%E9%A2%98" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. present 半屏问题</h2>
<p><code>modalPresentationStyle</code>属性默认不是<code>UIModalPresentationFullScreen</code>了，需要根据需求手动设置。</p>
<pre><code class="language-plain_text">LXNavigationViewController *nav = [[LXNavigationViewController alloc] initWithRootViewController:loginViewController];
nav.modalPresentationStyle = UIModalPresentationFullScreen;
[self presentViewController:nav animated:YES completion:nil];

</code></pre>
<ul>
<li>
<p>全局hook <code>presentViewController</code>方法</p>
<pre><code class="language-plain_text">+ (void)hoookPresentFuc{
    [UIViewController aspect_hookSelector:@selector(presentViewController:animated:completion:) withOptions:AspectPositionBefore usingBlock:^(id&lt;AspectInfo&gt; aspectInfo){
        UIViewController *presentingVC =  (UIViewController *)aspectInfo.arguments.firstObject;
        presentingVC.modalPresentationStyle = UIModalPresentationFullScreen;
    } error:NULL];
}

</code></pre>
</li>
</ul>
<h2><a id="4-uitextfield" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. UITextField</h2>
<ul>
<li>支付输入密码有问题</li>
</ul>
<h3><a id="uitextfield%E7%9A%84%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7-placeholderlabel%E8%A2%AB%E7%A6%81%E6%AD%A2%E8%AE%BF%E9%97%AE%E4%BA%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>UITextField 的私有属性 _placeholderLabel 被禁止访问了</h3>
<ul>
<li><code>_placeholderLabel.textColor</code> 私有属性被禁止访问</li>
</ul>
<pre><code class="language-plain_text">[self.textField setValue:self.placeholderColor forKeyPath:@&quot;_placeholderLabel.textColor&quot;];
</code></pre>
<p>崩溃信息：</p>
<pre><code class="language-plain_text">'Access to UITextField's _placeholderLabel ivar is prohibited. 
This is an application bug' 
</code></pre>
<ul>
<li>解决方案</li>
</ul>
<pre><code class="language-plain_text">UITextField有个attributedPlaceholder的属性，我们可以自定义这个富文本来达到我们需要的结果。

NSMutableAttributedString *placeholderString = [[NSMutableAttributedString alloc] initWithString:placeholder attributes:@{NSForegroundColorAttributeName : self.placeholderColor}];
_textField.attributedPlaceholder = placeholderString;
</code></pre>
<ul>
<li>项目适配代码</li>
</ul>
<pre><code class="language-plain_text">if (@available(iOS 13.0, *)) {
    if (textField.attributedText.length &gt; 0) {
        color = textField.attributedText.color;
    }
}else{
    color = [textField valueForKeyPath:@&quot;_placeholderLabel.textColor&quot;];
}
</code></pre>
<p>iOS 13 通过 KVC 方式修改私有属性，有 Crash 风险，谨慎使用！并不是所有KVC都会Crash，要尝试！</p>
<h2><a id="5-uitextview%E5%90%8C%E4%B8%8A" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. UITextView 同上</h2>
<h2><a id="6-navigationbar%E4%BD%BF%E7%94%A8-uinavigation-sxfixspace" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>6. navigationBar 使用<code>UINavigation+SXFixSpace</code></h2>
<pre><code class="language-plain_text">if ([NSStringFromClass(subview.class) containsString:@&quot;ContentView&quot;]) {
    // 结构调整后 在这里return掉
    if (@available(iOS 13.0, *)) {
        if ([NSStringFromClass(subview.class) containsString:@&quot;_UINavigationBarContentView&quot;]) {
            return;
        }
    }

    //可修正iOS11之后的偏移
    subview.layoutMargins = UIEdgeInsetsMake(0, space, 0, space);break;
}
</code></pre>
<p>同时，下面的属性也已经被禁止访问了：</p>
<ul>
<li>
<p><code>[barBgView valueForKey:@&quot;_shadowView&quot;];</code></p>
</li>
<li>
<p><code>[barBgView valueForKey:@&quot;_backgroundEffectView&quot;];</code></p>
</li>
</ul>
<h2><a id="7-statusbar" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>7. statusBar</h2>
<ul>
<li><code>UIStatusBarStyleDefault</code>枚举值代表含义有变化</li>
</ul>
<pre><code class="language-plain_text">typedef NS_ENUM(NSInteger, UIStatusBarStyle) {
    UIStatusBarStyleDefault                                  = 0, // 根据用户交互样式自动选择状态条样式
    UIStatusBarStyleLightContent     API_AVAILABLE(ios(7.0)) = 1, // Light content, for use on dark backgrounds
    UIStatusBarStyleDarkContent     API_AVAILABLE(ios(13.0)) = 3, // Dark content, for use on light backgrounds
    
    UIStatusBarStyleBlackTranslucent NS_ENUM_DEPRECATED_IOS(2_0, 7_0, &quot;Use UIStatusBarStyleLightContent&quot;) = 1,
    UIStatusBarStyleBlackOpaque      NS_ENUM_DEPRECATED_IOS(2_0, 7_0, &quot;Use UIStatusBarStyleLightContent&quot;) = 2,
} API_UNAVAILABLE(tvos);
</code></pre>
<ul>
<li>定制状态条的样式 使用apple 推荐的这个系统方法</li>
</ul>
<pre><code class="language-plain_text">// ios 13.0 之后，这个方法已经失效了
// [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleDefault];

- (UIStatusBarStyle)preferredStatusBarStyle {
    if (@available(iOS 13.0, *)){
        return UIStatusBarStyleDarkContent;
    }
    return UIStatusBarStyleDefault;
}
</code></pre>
<p><strong>或者 ------&gt;&gt;：</strong></p>
<p><code>UIStatusBarStyleDefault</code> 替换为</p>
<pre><code class="language-plain_text">(@available(iOS 13.0, *) ? UIStatusBarStyleDarkContent : UIStatusBarStyleDefault)
</code></pre>
<p>如果你还是使用的Xcode 10 为了走过编译器这一步，可以使用预编译命令，这么写：</p>
<pre><code class="language-plain_text">#if defined(__IPHONE_13_0) &amp;&amp; __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= __IPHONE_13_0
    if (@available(iOS 13.0, *)) {
        [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleDarkContent];
    }else{
        [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleDefault];
    }
#else
    [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleDefault];
#endif
</code></pre>
<h2><a id="8-uitabbar" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>8. UITabbar</h2>
<ul>
<li>横线
UITabbar 层次发生改变，无法通过设置 shadowImage去掉上面的线；</li>
<li>红点
如果之前有通过TabBar上图片位置来设置红点位置，在iOS13上会发现显示位置都在最左边去了。遍历UITabBarButton的subViews发现只有在TabBar选中状态下才能取到UITabBarSwappableImageView，解决办法是修改为通过UITabBarButton的位置来设置红点的frame</li>
</ul>
<h2><a id="9-uisearchbar" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>9. UISearchBar</h2>
<ul>
<li>UISearchBar的私有属性<code>UISearchBarBackground</code>，禁止访问和remove</li>
</ul>
<pre><code class="language-plain_text">if ([subview isKindOfClass:NSClassFromString(@&quot;UISearchBarBackground&quot;)]) {
    if (@available(iOS 13.0, *)) {
        subview.backgroundColor = [UIColor lightGrayColor];
        // subview.layer.contents = nil;
    }else{
        [subview removeFromSuperview];
    }
}

</code></pre>
<h2><a id="10%E5%A2%9E%E5%8A%A0%E4%B8%80%E7%9B%B4%E4%BD%BF%E7%94%A8%E8%93%9D%E7%89%99%E7%9A%84%E6%9D%83%E9%99%90%E7%94%B3%E8%AF%B7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>10. 增加一直使用蓝牙的权限申请</h2>
<p><code>info.plist</code>文件下
Key: <code>NSBluetoothAlwaysUsageDescription</code>
Value: <code>我们要一直使用您的蓝牙，具体做什么别问我</code></p>
<h2><a id="11%E6%8E%A8%E9%80%81%E8%8E%B7%E5%8F%96-devicetoken" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>11. 推送 获取deviceToken</h2>
<pre><code class="language-plain_text">#include &lt;arpa/inet.h&gt;
- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken
{
    if (![deviceToken isKindOfClass:[NSData class]]) return;
    const unsigned *tokenBytes = [deviceToken bytes];
    NSString *hexToken = [NSString stringWithFormat:@&quot;%08x%08x%08x%08x%08x%08x%08x%08x&quot;,
                          ntohl(tokenBytes[0]), ntohl(tokenBytes[1]), ntohl(tokenBytes[2]),
                          ntohl(tokenBytes[3]), ntohl(tokenBytes[4]), ntohl(tokenBytes[5]),
                          ntohl(tokenBytes[6]), ntohl(tokenBytes[7])];
    NSLog(@&quot;deviceToken:%@&quot;,hexToken);
}
</code></pre>
<h2><a id="12-cncopycurrentnetworkinfo" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>12. CNCopyCurrentNetworkInfo</h2>
<pre><code class="language-plain_text"> An app that fails to meet any of the above requirements receives the following return value:

- An app linked against iOS 12 or earlier receives a dictionary with pseudo-values. In this case, the SSID is Wi-Fi (or WLAN in the China region), and the BSSID is 00:00:00:00:00:00.
- An app linked against iOS 13 or later receives NULL.
- 
</code></pre>
<p>iOS13 以后只有开启了 Access WiFi Information capability，才能获取到 SSID 和 BSSID</p>
<p><a href="https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fsystemconfiguration%2F1614126-cncopycurrentnetworkinfo%3Flanguage%3Docc">参考：CNCopyCurrentNetworkInfo</a></p>
<h2><a id="13-app%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96%E5%AF%BC%E8%87%B4-frame%E8%8E%B7%E5%8F%96%E5%A4%B1%E8%B4%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>13. APP 启动速度优化 导致frame获取失败</h2>
<p>App启动过程中，部分View可能无法实时获取到frame。</p>
<h2><a id="14-wkwebview%E4%B8%AD%E6%B5%8B%E9%87%8F%E9%A1%B5%E9%9D%A2%E5%86%85%E5%AE%B9%E9%AB%98%E5%BA%A6%E7%9A%84%E6%96%B9%E5%BC%8F%E5%8F%98%E6%9B%B4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>14. WKWebView 中测量页面内容高度的方式变更</h2>
<p>iOS 13以前 document.body.scrollHeight iOS 13中 document.documentElement.scrollHeight 两者相差55 应该是浏览器定义高度变了</p>
<h2><a id="15-fishhook%E5%AF%BC%E8%87%B4%E7%9A%84-crash" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>15. fishhook 导致的Crash</h2>
<p><a href="https://github.com/facebook/fishhook/issues">github fishhook</a></p>
<h2><a id="16-mpmovieplayercontroller%E5%B7%B2%E7%BB%8F%E8%A2%AB%E5%BC%83%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>16. MPMoviePlayerController 已经被弃用</h2>
<pre><code class="language-plain_text">'MPMoviePlayerController is no longer available. Use AVPlayerViewController in AVKit.' 
</code></pre>
<h2><a id="17-launchimage%E5%8D%B3%E5%B0%86%E6%B6%88%E5%A4%B1" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>17. LaunchImage 即将消失</h2>
<p>从 iOS 8 的时候，苹果就引入了 LaunchScreen，我们可以设置 LaunchScreen来作为启动页。当然，现在你还可以使用LaunchImage来设置启动图。不过使用LaunchImage的话，要求我们必须提供各种屏幕尺寸的启动图，来适配各种设备，随着苹果设备尺寸越来越多，这种方式显然不够 Flexible。而使用 LaunchScreen的话，情况会变的很简单， LaunchScreen是支持AutoLayout+SizeClass的，所以适配各种屏幕都不在话下。
注意啦⚠️，从2020年4月开始，所有使⽤ iOS13 SDK 的 App 将必须提供 LaunchScreen，LaunchImage即将退出历史舞台。</p>
<h2><a id="18-window%E5%B1%82%E7%BA%A7%E5%8F%98%E5%8C%96" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>18. window层级变化</h2>
<p>遍历视图获取 keywindow 的方式会失效。
新增了 screenWindow  自定义视图和 keywindow之间新增iOS 13系统的特有图层。</p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T11:03:07+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336621877205.html" itemprop="url">
		iOS 之 自动打包 fastlane + fir + pgy 【进阶使用】</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2><a id="%E5%AE%89%E8%A3%85fastlane" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装 fastlane</h2>
<p><a href="https://www.jianshu.com/p/88b9a3e378db">fastlane 安装使用指南</a></p>
<h2><a id="fastlane%E9%85%8D%E7%BD%AE%E9%A1%B9%E7%9B%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>fastlane 配置项目</h2>
<ul>
<li>
<p>cd 到项目根目录下</p>
</li>
<li>
<p><code>fastlane init</code></p>
</li>
<li>
<p><a href="https://docs.fastlane.tools/advanced/actions/">fastlane action</a></p>
</li>
<li>
<p><a href="https://docs.fastlane.tools/plugins/using-plugins/#fastlane-plugins">fastlane plugin</a></p>
</li>
<li>
<p>gym 请参考：<a href="https://docs.fastlane.tools/actions/gym/">gym官方文档</a></p>
</li>
</ul>
<p><strong>有一点比较坑：每个项目都需要为fastlane配置下环境,关联开发账户</strong></p>
<h2><a id="%E5%AE%89%E8%A3%85%E6%89%93%E5%8C%85%E5%B9%B3%E5%8F%B0%E5%91%BD%E4%BB%A4%E5%B7%A5%E5%85%B7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装打包平台命令工具</h2>
<ul>
<li>安装firim</li>
</ul>
<pre><code class="language-bash">fastlane add_plugin versioning
fastlane add_plugin firim
</code></pre>
<p><code>versioning</code> 需要输入电脑密码，以获取<code>sudo</code>权限.</p>
<p>firim 相关参数可参考：<a href="https://github.com/whlsxl/firim/blob/master/lib/firim/options.rb">firim 源码说明</a></p>
<ul>
<li>安装 fir_cli</li>
</ul>
<pre><code class="language-plain_text">fastlane add_plugin versioning
fastlane add_plugin fir_cli
</code></pre>
<p>fir_cli相关参数可参考 ：<a href="https://github.com/FIRHQ/fastlane-plugin-fir_cli">fir_cli使用说明</a></p>
<ul>
<li>安装蒲公英</li>
</ul>
<p><a href="http://www.pgyer.com/doc/view/fastlane">蒲公英官方文档说明</a>
<a href="https://github.com/shishirui/fastlane-plugin-pgyer">蒲公英插件API说明</a></p>
<pre><code class="language-bash">fastlane add_plugin pgyer
</code></pre>
<p>需要输入 y,以确认安装.</p>
<ul>
<li>
<p>Pluginfile</p>
<p>此时 fastlane/Pluginfile 文件内应该是这样子的：</p>
<pre><code class="language-bash">gem 'fastlane-plugin-pgyer'
gem 'fastlane-plugin-versioning'
gem 'fastlane-plugin-firim'
</code></pre>
</li>
<li>
<p>fastlane action</p>
</li>
</ul>
<p>定义一个 Action 叫 <code>PY_release</code>:</p>
<pre><code class="language-plain_text">lane :PY_release do |options|
    gym(
      clean:true, #打包前clean项目
      silent:true,
      export_method: &quot;development&quot;, #导出方式
      scheme:&quot;LXPeiyou&quot;, #scheme
      configuration: options[:configuration],#环境
      output_directory:&quot;./AppOutput&quot;,#ipa的存放目录
      output_name:&quot;********&quot;#输出ipa的文件名为当前的build号
      )
    
    # 自己的fir账号
    # firim(firim_api_token:'*****', app_changelog:options[:update_info])
    
    #蒲公英的配置 替换为自己的api_key和user_key
    # pgyer(api_key: &quot;******&quot;, user_key: &quot;******&quot;,update_description: options[:update_info])
  end
</code></pre>
<p><strong>外部调用</strong>
执行Action 并传参：</p>
<pre><code class="language-bash">fastlane PY_release configuration:$configuration update_info:$update_info
</code></pre>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T11:02:25+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336621451455.html" itemprop="url">
		ios 之 自动打包 脚本 【bash 版本】</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2><a id="%E9%85%8D%E7%BD%AE%E6%89%93%E5%8C%85%E4%BF%A1%E6%81%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>配置打包信息</h2>
<pre><code class="language-bash"># 工程名称
kProjectName=&quot;ipa.xcodeproj&quot;

# workspace 名称 如果使用了cocopods等可能需要用工作空间方式打包
# workspaceName=“ipa.workspace”

# scheme名称
kSchemeName=&quot;ipa&quot;

# target 这里scheme只对应了一个target运行；如果有多个target需要指定target
kTargetName=&quot;ipa&quot;

# APP环境配置 Configuration
kConfiguration=&quot;Release&quot;

# archive导出路径
kArchivePath=&quot;./ipaOutput/${kSchemeName}.xcarchive&quot;

# ipa导出路径
kExport_ipa_Path=&quot;./ipaOutput/${kSchemeName}&quot;

# 不同的打包方式这个导出文件不同 [这个文件很重要，他决定了你的包是否能够正常导出] 
# 用Xcode自带的archive方式导出ipa的时候，这个文件会随之导出
kExportOptionsPlist=&quot;./ipaOutput/ExportOptions.plist&quot;

kAppChangelog=&quot;Tips:我是版本更新信息&quot;
</code></pre>
<h2><a id="%E6%89%93%E5%8C%85%E5%AF%BC%E5%87%BA" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>打包 &amp;&amp; 导出</h2>
<pre><code class="language-bash"># clean
xcodebuild  clean -configuration &quot;$configuration&quot; -alltargets

# archive project
xcodebuild archive -project &quot;$kProjectName&quot; -scheme &quot;$kSchemeName&quot; -configuration &quot;$kConfiguration&quot; -archivePath &quot;$kArchivePath&quot;

# archive workspace
# #xcodebuild  archive  -workspace &quot;$workspaceName&quot; -scheme &quot;$scheme&quot; -configuration  &quot;$kConfiguration&quot;  -archivePath &quot;$kArchivePath&quot;  

# 导出ipa
xcodebuild -exportArchive -archivePath &quot;$kArchivePath&quot; -exportOptionsPlist &quot;$kExportOptionsPlist&quot; -exportPath &quot;$kExport_ipa_Path&quot;
</code></pre>
<h2><a id="%E4%B8%8A%E4%BC%A0ipa%E5%88%B0%E5%88%86%E5%8F%91%E5%B9%B3%E5%8F%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>上传ipa到分发平台</h2>
<pre><code class="language-bash"># --------------&gt; 检测IPA存在否
ipa_path=&quot;${kExport_ipa_Path}/${kSchemeName}.ipa&quot;

if [ -f &quot;$ipa_path&quot; ]
	then
		echo &quot;------------ipa存在😁......&quot;
	else
		echo &quot;------------ipa不存在😭......&quot;
		exit 1
fi
</code></pre>
<h3><a id="%E4%B8%8A%E4%BC%A0%E5%88%B0fir" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>上传到fir</h3>
<pre><code class="language-bash"># --------- firm 上传配置

echo &quot;请选择登录账户名：\n 1）kael 自己的fir账户（默认） \n 2）公司的fir账户&quot;

read fir_token

if [[ $fir_token == 2 ]]; then
  #公司账号
  fir_token=&quot;*********&quot;
else
  # 自己的账号
  fir_token=&quot;*********&quot;
fi

fir publish ${ipa_path} -T $fir_token -c $kAppChangelog
</code></pre>
<h3><a id="%E4%B8%8A%E4%BC%A0%E5%88%B0pgy" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>上传到pgy</h3>
<pre><code class="language-bash"># -------- pgy 上传

echo &quot;------------准备发布蒲公英------------&quot;
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;蒲公英账号信息配置
#蒲公英账号
pgy_API_Key=&quot;*********&quot;
pgy_User_Key=&quot;*********&quot;


# ------&gt; 蒲公英发布
curl -F &quot;file=@$ipa_path&quot; \
-F &quot;uKey=$pgy_User_Key&quot; \
-F &quot;_api_key=$pgy_API_Key&quot; \
-F &quot;updateDescription=$kAppChangelog&quot; \
https://www.pgyer.com/apiv1/app/upload
</code></pre>
<h2><a id="%E8%84%9A%E6%9C%AC" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>脚本</h2>
<pre><code class="language-bash">#!/bin/sh

# 工程名称
kProjectName=&quot;ipa.xcodeproj&quot;

# workspace 名称 如果使用了cocopods等可能需要用工作空间方式打包
# workspaceName=“ipa.workspace”

# scheme名称
kSchemeName=&quot;ipa&quot;

# target 这里scheme只对应了一个target运行；如果有多个target需要指定target
kTargetName=&quot;ipa&quot;

# APP环境配置
kConfiguration=&quot;Release&quot;

# archive导出路径
kArchivePath=&quot;./ipaOutput/${kSchemeName}.xcarchive&quot;

# ipa导出路径
kExport_ipa_Path=&quot;./ipaOutput/${kSchemeName}&quot;

# 不同的打包方式这个导出文件不同
kExportOptionsPlist=&quot;./ipaOutput/ExportOptions.plist&quot;

kAppChangelog=&quot;Tips:我是版本更新信息&quot;


# ------------------&gt; 打包区
# clean
xcodebuild  clean -configuration &quot;$configuration&quot; -alltargets

# archive project
xcodebuild archive -project &quot;$kProjectName&quot; -scheme &quot;$kSchemeName&quot; -configuration &quot;$kConfiguration&quot; -archivePath &quot;$kArchivePath&quot;

# archive workspace
# #xcodebuild  archive  -workspace &quot;$workspaceName&quot; -scheme &quot;$scheme&quot; -configuration  &quot;$kConfiguration&quot;  -archivePath &quot;$kArchivePath&quot;  

# 导出ipa
xcodebuild -exportArchive -archivePath &quot;$kArchivePath&quot; -exportOptionsPlist &quot;$kExportOptionsPlist&quot; -exportPath &quot;$kExport_ipa_Path&quot;


# --------------&gt; 检测IPA存在否
ipa_path=&quot;${kExport_ipa_Path}/${kSchemeName}.ipa&quot;

if [ -f &quot;$ipa_path&quot; ]
	then
		echo &quot;------------ipa存在😁......&quot;
	else
		echo &quot;------------ipa不存在😭......&quot;
		exit 1
fi

# --------- firm 上传配置

echo &quot;请选择登录账户名：\n 1）kael 自己的fir账户（默认） \n 2）公司的fir账户&quot;

read fir_token

if [[ $fir_token == 2 ]]; then
  #公司账号
  fir_token=&quot;*********&quot;
else
  # 自己的账号
  fir_token=&quot;*********&quot;
fi

fir publish ${ipa_path} -T $fir_token -c $kAppChangelog

# -------- pgy 上传

echo &quot;------------准备发布蒲公英------------&quot;
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;蒲公英账号信息配置
#蒲公英账号
pgy_API_Key=&quot;*********&quot;
pgy_User_Key=&quot;*********&quot;


# ------&gt; 蒲公英发布
curl -F &quot;file=@$ipa_path&quot; \
-F &quot;uKey=$pgy_User_Key&quot; \
-F &quot;_api_key=$pgy_API_Key&quot; \
-F &quot;updateDescription=$kAppChangelog&quot; \
https://www.pgyer.com/apiv1/app/upload
</code></pre>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T11:02:14+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336621349772.html" itemprop="url">
		Xcode 11 Xib `_UITextLayoutView` 崩溃</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>崩溃信息如下：</p>
<pre><code class="language-plain_text">*** Terminating app due to uncaught exception 
'NSInvalidUnarchiveOperationException', 
reason: 'Could not instantiate class named _UITextLayoutView because no class named _UITextLayoutView was found; 
the class needs to be defined in source code or linked in from a library (ensure the class is part of the correct target)'
</code></pre>
<p>解决方案：</p>
<h2><a id="%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%B8%80" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>解决方案 一</h2>
<p>xib的部分视图改用硬核手写，以避坑。</p>
<h2><a id="%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%BA%8C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>解决方案 二</h2>
<p><a href="https://developer.apple.com/download/more">下载其他版本Xcode 传送门</a></p>
<h2><a id="%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%B8%89" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>解决方案 三</h2>
<p>OC 黑魔法 <code>Runtime</code>。</p>
<ul>
<li>
<p>创建 文件 <code>UITextViewWorkaround</code></p>
</li>
<li>
<p>UITextViewWorkaround.h</p>
</li>
</ul>
<pre><code class="language-plain_text">#import &lt;Foundation/Foundation.h&gt;

@interface UITextViewWorkaround : NSObject
+ (void)executeWorkaround; 
@end

</code></pre>
<ul>
<li>UITextViewWorkaround.m</li>
</ul>
<pre><code class="language-plain_text">#import &quot;UITextViewWorkaround.h&quot;
#import  &lt;objc/runtime.h&gt;



@implementation UITextViewWorkaround

+ (void)executeWorkaround {
    if (@available(iOS 13.2, *)) {

    }
    else {
        const char *className = &quot;_UITextLayoutView&quot;;
        Class cls = objc_getClass(className);
        if (cls == nil) {
            cls = objc_allocateClassPair([UIView class], className, 0);
            objc_registerClassPair(cls);
#if DEBUG
            printf(&quot;added %s dynamically\n&quot;, className);
#endif
        }
    }
}

@end
</code></pre>
<ul>
<li>使用该静态方法</li>
</ul>
<pre><code class="language-plain_text">#import &quot;UITextViewWorkaround.h&quot;

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    // Override point for customization after application launch.

    [UITextViewWorkaround executeWorkaround];
    return yes;
}
</code></pre>
<ul>
<li>swift 版本请客观收下：</li>
</ul>
<pre><code class="language-plain_text">import UIKit

@objc
class UITextViewWorkaround : NSObject {

    static func executeWorkaround() {
        if #available(iOS 13.2, *) {
        } else {
            let className = &quot;_UITextLayoutView&quot;
            let theClass = objc_getClass(className)
            if theClass == nil {
                let classPair: AnyClass? = objc_allocateClassPair(UIView.self, className, 0)
                objc_registerClassPair(classPair!)
            }
        }
    }

}
</code></pre>
<p><a href="https://stackoverflow.com/questions/58657087/after-upgrading-to-xcode-11-2-from-xcode-11-1-app-crashes-due-to-uitextlayoutv">参考</a></p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T10:58:47+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336619273999.html" itemprop="url">
		ios 之 自动打包 一键打包脚本 【bash优化版本】</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2><a id="%E9%80%89%E6%8B%A9%E6%89%93%E5%8C%85scheme" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>选择打包scheme</h2>
<pre><code class="language-bash"># 选择打包环境
function selectedScheme() {
  #statements
  echo &quot;请选择打包对象: \n 1) GaoKao(**高考) \n 2) Zhongkao(**中考)&quot;
  read app_scheme

  if [[ $app_scheme == 1 ]]; then
    echo &quot;您选择的是：GaoKao(**高考)&quot;
    app_scheme=&quot;GaoKao&quot;
  elif [[ $app_scheme == 2 ]]; then
    echo &quot;您选择的是：Zhongkao(**中考)&quot;
    app_scheme=&quot;Zhongkao&quot;
  else
    selectedScheme
  fi
}
</code></pre>
<h2><a id="%E9%80%89%E6%8B%A9%E6%89%93%E5%8C%85%E7%8E%AF%E5%A2%83" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>选择打包环境</h2>
<pre><code class="language-bash">function selectedConfiguration() {
  #statements
  echo &quot;-- 😁 --\n&quot;
  echo &quot;--\n&quot;
  echo &quot;请选择打包环境:\n 1)Release \n 2)LXRelease_dev \n 3)LXRelease_kfc \n 4)LXRelease_tsl&quot;

  read configuration

  if [[ $configuration == 1 ]]; then
    echo &quot;您选择的是Release环境&quot;
    configuration=&quot;Release&quot;
  elif [[ $configuration == 2 ]]; then
    echo &quot;您选择的是LXRelease_dev环境&quot;
    configuration=&quot;LXRelease_dev&quot;
  elif [[ $configuration == 3 ]]; then
    echo &quot;您选择的是LXRelease_kfc环境&quot;
    configuration=&quot;LXRelease_kfc&quot;
  elif [[ $configuration == 4 ]]; then
    echo &quot;您选择的是LXRelease_tsl环境&quot;
    configuration=&quot;LXRelease_tsl&quot;
  else
    selectedConfiguration
  fi
}
</code></pre>
<h2><a id="%E8%AF%BB%E5%8F%96%E6%9B%B4%E6%96%B0%E4%BF%A1%E6%81%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>读取更新信息</h2>
<pre><code class="language-bash">function readUpdateInfo() {
  echo &quot;-\n&quot;
  echo &quot;--\n&quot;
  echo &quot;请输入您当前版本更新信息:&quot;

  read update_info
}
</code></pre>
<h2><a id="%E6%89%93%E5%8D%B0%E6%89%93%E5%8C%85%E4%BF%A1%E6%81%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>打印打包信息</h2>
<pre><code class="language-bash">function logPackageInfo() {
  echo &quot;打包信息----------&gt;:\n&quot;
  echo &quot;打包scheme是   --&gt;: ${app_scheme}&quot;
  echo &quot;您选择的是     --&gt;: ${configuration}&quot;
  echo &quot;版本更新信息   --&gt;: ${update_info}&quot;
}
</code></pre>
<h2><a id="%E4%B8%8A%E4%BC%A0dsym%E5%88%B0bugly%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>上传dSYM到bugly进行分析</h2>
<pre><code class="language-bash"># --------------------&gt;&gt; 上传 dSYM 文件
function uploaddSYMFile() {
  #statements
  echo &quot;bugly --- start......&quot;

  output_file_name=&quot;&quot;
  bugly_appName=&quot;&quot;
  bugly_configName=&quot;&quot;

  if [[ ${app_scheme} = &quot;GaoKao&quot; ]]; then
    bugly_appName=&quot;**高考&quot;
  elif [[ ${app_scheme} == &quot;Zhongkao&quot; ]]; then
    bugly_appName=&quot;**中考&quot;
  fi

  if [[ ${configuration} = &quot;LXRelease&quot; ]]; then
    bugly_configName=&quot;&quot;
  elif [[ ${configuration} = &quot;LXRelease_dev&quot; ]]; then
    bugly_configName=&quot;dev&quot;
  elif [[ ${configuration} = &quot;LXRelease_tsl&quot; ]]; then
    bugly_configName=&quot;tsl&quot;
  elif [[ ${configuration} = &quot;LXRelease_kfc&quot; ]]; then
    bugly_configName=&quot;kfc&quot;
  fi

  output_file_name=&quot;${app_scheme}_${configuration}&quot;

  bugly_dsym_zip_path=&quot;./AppOutput/${output_file_name}.app.dSYM.zip&quot;

  echo &quot;kael ------rm&quot;
  # rm &quot;./AppOutput/dsym_upload/&quot;
  find &quot;./AppOutput/dsym_upload/&quot; -name &quot;*.dSYM&quot; | xargs rm -rf
  find &quot;./AppOutput/&quot; -name &quot;dsym_upload.zip&quot; | xargs rm -rf
  echo &quot;kael ------rm -- end&quot;

  # 解压文件
  echo &quot;kael ------unzip&quot;
  echo &quot;path -- $bugly_dsym_zip_path&quot;
  unzip ${bugly_dsym_zip_path} -d &quot;./AppOutput/dsym_upload/&quot;

  bugly_java_path=&quot;./buglySymboliOS/buglySymboliOS.jar&quot;
  bugly_dsym_path=&quot;./AppOutput/dsym_upload/&quot;
  echo &quot;${bugly_dsym_path}&quot;

  echo &quot;kael ------upload start&quot;
  java -jar $bugly_java_path -i $bugly_dsym_path -dsym -u -id 900058462 -key f8V5dgJO5em0CPPk -package com.lexue.lexuegaokao -version 3.3.3

}
</code></pre>
<h2><a id="%E6%99%AE%E9%80%9A%E6%89%93%E5%8C%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>普通打包</h2>
<pre><code class="language-bash"># --------------------&gt;&gt;  普通打包任务
function normal_archive() {
  #statements
  selectedScheme
  # # 等待 沉睡
  # sleep 0.5s
  # 选择打包环境
  selectedConfiguration
  # 等待 沉睡
  sleep 0.5s
  # 读取版本更新信息
  readUpdateInfo
  # 等待 沉睡
  sleep 0.5s
  # 打印更新信息
  logPackageInfo

  fastlane ipa_release scheme:$app_scheme configuration:$configuration update_info:$update_info

  logPackageInfo

  uploaddSYMFile

}
</code></pre>
<h2><a id="%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%A4%9Ascheme%E6%89%93%E5%8C%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>多环境 多scheme 打包</h2>
<pre><code class="language-bash"># --------------------&gt;&gt; 单个打包任务
function one_serial_archive() {
  app_scheme=$1
  configuration=$2
  update_info=$3
  #打印信息
  logPackageInfo
  # 打包导出
  fastlane ipa_release scheme:$app_scheme configuration:$configuration update_info:$update_info
  # 打印信息
  logPackageInfo
  # 上传dSYM
  uploaddSYMFile
} 
# --------------------&gt;&gt; 多个打包任务
function serial_archive() {
  readUpdateInfo

  # 中考
  one_serial_archive &quot;Zhongkao&quot; &quot;Release&quot; $update_info
  one_serial_archive &quot;Zhongkao&quot; &quot;LXRelease_dev&quot; $update_info
  one_serial_archive &quot;Zhongkao&quot; &quot;LXRelease_kfc&quot; $update_info
  one_serial_archive &quot;Zhongkao&quot; &quot;LXRelease_tsl&quot; $update_info
  # 高考
  one_serial_archive &quot;GaoKao&quot; &quot;Release&quot; $update_info
  one_serial_archive &quot;GaoKao&quot; &quot;LXRelease_dev&quot; $update_info
  one_serial_archive &quot;GaoKao&quot; &quot;LXRelease_kfc&quot; $update_info
  one_serial_archive &quot;GaoKao&quot; &quot;LXRelease_tsl&quot; $update_info
}
</code></pre>
<h2><a id="%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>脚本使用</h2>
<pre><code class="language-bash"># 打包一系列环境的包
serial_archive
</code></pre>
<p>命令行工具中输入<code>sh ipa.sh</code>即可</p>
<h2><a id="%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>文件共享</h2>
<p>buly文件链接:<a href="https://pan.baidu.com/s/13jaP6Jggp6DcDwqXYeEjHg">https://pan.baidu.com/s/13jaP6Jggp6DcDwqXYeEjHg</a>  密码:lowx
JDK(java环境安装文件)链接:<a href="https://pan.baidu.com/s/1NtGdP0cANQz7TtyYU2mycg">https://pan.baidu.com/s/1NtGdP0cANQz7TtyYU2mycg</a>  密码:f6af</p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T10:58:08+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336618881036.html" itemprop="url">
		iPad 横屏启动 界面错乱</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<blockquote>
<p>现象：iPad 开启屏幕旋转，横屏启动APP，某些特殊情况下，APP会变成横屏APP。恭喜你，中奖了，这时候即使你ViewController的控制屏幕旋转的三个代理方法都只支持竖屏，你的APP也可能是错乱的。</p>
</blockquote>
<ul>
<li>神奇的解决方案：
<ul>
<li><code>mainScreen</code>添加一个window，<code>makeKeyAndVisible</code></li>
<li>然后<code>resignKeyWindow</code></li>
</ul>
</li>
</ul>
<pre><code class="language-plain_text">- (void)showMagicWindow{
    UIWindow *aawindow = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];
       aawindow.backgroundColor = [UIColor clearColor];
       aawindow.windowLevel = UIWindowLevelAlert;
       [aawindow makeKeyAndVisible];
    [aawindow resignKeyWindow];
       aawindow.hidden = YES;
       aawindow = nil;
}
</code></pre>
<p>哪位大神能解释下？</p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2021-10-08T10:57:57+08:00" itemprop="datePublished">2021/10/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='ios.html'>iOS</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="16336618777988.html" itemprop="url">
		钉钉机器人</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<pre><code class="language-plain_text">curl 'https://oapi.dingtalk.com/robot/send?access_token=8c022fd6586126b80994e1b551ce31ab6ee56ed045c47c51c8ab0192c723cb1e' \
   -H 'Content-Type: application/json' \
   -d '{
			&quot;msgtype&quot;: &quot;text&quot;,
			&quot;text&quot;: {
             &quot;content&quot;: &quot;高考iOS最新安装包 ipa--https://fir.im/lgk&quot;
        },
			&quot;at&quot;: {
        	&quot;atMobiles&quot;: [
                &quot;15718808963&quot;,
                &quot;13241411941&quot;,
                &quot;13466778405&quot;,
                &quot;13716307872&quot;
        ],
        &quot;isAtAll&quot;: false
		}
      }'
</code></pre>
<p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>参数类型</th>
<th>必须</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>msgtype</td>
<td>String</td>
<td>是</td>
<td>消息类型，此时固定为：text</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td>是</td>
<td>消息内容</td>
</tr>
<tr>
<td>atMobiles</td>
<td>Array</td>
<td>否</td>
<td>被@人的手机号(在content里添加@人的手机号)</td>
</tr>
<tr>
<td>isAtAll</td>
<td>bool</td>
<td>否</td>
<td>@所有人时：true，否则为：false</td>
</tr>
</tbody>
</table>
<pre><code class="language-bash">#!/bin/sh


# -----------------&gt; 基本信息配置区
# 工程名称
kProjectName=&quot;ipa.xcodeproj&quot;
# scheme名称
kSchemeName=&quot;ipa&quot;
# target 这里scheme只对应了一个target运行；如果有多个target需要制定target
kTargetName=&quot;ipa&quot;
# APP环境配置
kConfiguration=&quot;Release&quot;
# archive导出路径
kArchivePath=&quot;./ipaOutput/${kSchemeName}.xcarchive&quot;
# ipa导出路径
kExport_ipa_Path=&quot;./ipaOutput/${kSchemeName}&quot;
# 不同的打包方式这个导出文件不同
kExportOptionsPlist=&quot;./ipaOutput/ExportOptions.plist&quot;

kAppChangelog=&quot;kael-我是版本更新信息&quot;

# ------------------&gt; 打包区
# clean
xcodebuild  clean -configuration &quot;$configuration&quot; -alltargets

# archive project
xcodebuild archive -project &quot;$kProjectName&quot; -scheme &quot;$kSchemeName&quot; -configuration &quot;$kConfiguration&quot; -archivePath &quot;$kArchivePath&quot;

# archive workspace
# #xcodebuild  archive  -workspace &quot;$workspaceName&quot; -scheme &quot;$scheme&quot; -configuration  &quot;$kConfiguration&quot;  -archivePath &quot;$kArchivePath&quot;  

# 导出ipa
xcodebuild -exportArchive -archivePath &quot;$kArchivePath&quot; -exportOptionsPlist &quot;$kExportOptionsPlist&quot; -exportPath &quot;$kExport_ipa_Path&quot;

# --------------&gt; 检测IPA存在否
ipa_path=&quot;${kExport_ipa_Path}/${kSchemeName}.ipa&quot;

if [ -f &quot;$ipa_path&quot; ]
	then
		echo &quot;------------ipa存在😁......&quot;
	else
		echo &quot;------------ipa不存在😭......&quot;
		exit 1
fi

# --------- firm 上传配置

echo &quot;请选择登录账户名：\n 1）kael 自己的fir账户（默认） \n 2）公司的fir账户&quot;

read fir_token

if [[ $fir_token == 2 ]]; then
  #公司账号
  fir_token=&quot;bab4a513ef576e49dceb3abe9e9b028a&quot;
else
  # 自己的账号
  fir_token=&quot;b3bb54eca50a2545d0a6044cb19a616a&quot;
fi
# 钉钉机器人🤖
DD_access_token=&quot;8c022fd6586126b80994e1b551ce31ab6ee56ed045c47c51c8ab0192c723cb1e&quot;

fir publish ${ipa_path} -T $fir_token -c $kAppChangelog -D $DD_access_token

# -------- pgy 上传

echo &quot;------------准备发布蒲公英------------&quot;
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;蒲公英
#蒲公英账号
pgy_API_Key=&quot;ed34bd49e37a2a2943918d18b1489a71&quot;
pgy_User_Key=&quot;878381aa4356d997c1c4c7bb27649807&quot;


#蒲公英发布
curl -F &quot;file=@$ipa_path&quot; \
-F &quot;uKey=$pgy_User_Key&quot; \
-F &quot;_api_key=$pgy_API_Key&quot; \
-F &quot;updateDescription=$kAppChangelog&quot; \
https://www.pgyer.com/apiv1/app/upload


#钉钉群通知相关人员
curl 'https://oapi.dingtalk.com/robot/send?access_token=8c022fd6586126b80994e1b551ce31ab6ee56ed045c47c51c8ab0192c723cb1e' \
   -H 'Content-Type: application/json' \
   -d '{
            &quot;msgtype&quot;: &quot;text&quot;,
            &quot;text&quot;: {
             &quot;content&quot;: &quot;高考iOS最新安装包 ipa&quot;
        },
            &quot;at&quot;: {
            &quot;atMobiles&quot;: [
                &quot;15718808963&quot;,
                &quot;13241411941&quot;,
                &quot;13466778405&quot;,
                &quot;13716307872&quot;
        ],
        &quot;isAtAll&quot;: false
        }
      }'

</code></pre>


			
			
		</div>

	</article>
  

</div>
<nav id="pagenavi">
	 <a class="prev" href="ios.html">Prev</a>  
	 <a class="next" href="ios_2.html">Next</a> 
	<div class="center"><a href="archives.html">Blog Archives</a></div>

</nav>

</div>



        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>



  














<style type="text/css">
figure{margin: 1em 0;padding: 0;}
  figcaption{text-align:center;}

/* PrismJS 1.14.0
https://prismjs.com/download.html#themes=prism-coy&languages=markup+css+clike+javascript */
/**
 * prism.js Coy theme for JavaScript, CoffeeScript, CSS and HTML
 * Based on https://github.com/tshedor/workshop-wp-theme (Example: http://workshop.kansan.com/category/sessions/basics or http://workshop.timshedor.com/category/sessions/basics);
 * @author Tim  Shedor
 */

code[class*="language-"],
pre[class*="language-"] {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  position: relative;
  margin: .5em 0;
  overflow: visible;
  padding: 0;
}
pre[class*="language-"]>code {
  position: relative;
  border-left: 10px solid #358ccb;
  box-shadow: -1px 0px 0px 0px #358ccb, 0px 0px 0px 1px #dfdfdf;
  background-color: #fdfdfd;
  background-image: linear-gradient(transparent 50%, rgba(69, 142, 209, 0.04) 50%);
  background-size: 3em 3em;
  background-origin: content-box;
  background-attachment: local;
}

code[class*="language"] {
  max-height: inherit;
  height: inherit;
  padding: 0 1em;
  display: block;
  overflow: auto;
}

/* Margin bottom to accomodate shadow */
:not(pre) > code[class*="language-"],
pre[class*="language-"] {
  background-color: #fdfdfd;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  margin-bottom: 1em;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  position: relative;
  padding: .2em;
  border-radius: 0.3em;
  color: #c92c2c;
  border: 1px solid rgba(0, 0, 0, 0.1);
  display: inline;
  white-space: normal;
}

pre[class*="language-"]:before,
pre[class*="language-"]:after {
  content: '';
  z-index: -2;
  display: block;
  position: absolute;
  bottom: 0.75em;
  left: 0.18em;
  width: 40%;
  height: 20%;
  max-height: 13em;
  box-shadow: 0px 13px 8px #979797;
  -webkit-transform: rotate(-2deg);
  -moz-transform: rotate(-2deg);
  -ms-transform: rotate(-2deg);
  -o-transform: rotate(-2deg);
  transform: rotate(-2deg);
}

:not(pre) > code[class*="language-"]:after,
pre[class*="language-"]:after {
  right: 0.75em;
  left: auto;
  -webkit-transform: rotate(2deg);
  -moz-transform: rotate(2deg);
  -ms-transform: rotate(2deg);
  -o-transform: rotate(2deg);
  transform: rotate(2deg);
}

.token.comment,
.token.block-comment,
.token.prolog,
.token.doctype,
.token.cdata {
  color: #7D8B99;
}

.token.punctuation {
  color: #5F6364;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.function-name,
.token.constant,
.token.symbol,
.token.deleted {
  color: #c92c2c;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.function,
.token.builtin,
.token.inserted {
  color: #2f9c0a;
}

.token.operator,
.token.entity,
.token.url,
.token.variable {
  color: #a67f59;
  background: rgba(255, 255, 255, 0.5);
}

.token.atrule,
.token.attr-value,
.token.keyword,
.token.class-name {
  color: #1990b8;
}

.token.regex,
.token.important {
  color: #e90;
}

.language-css .token.string,
.style .token.string {
  color: #a67f59;
  background: rgba(255, 255, 255, 0.5);
}

.token.important {
  font-weight: normal;
}

.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}

.token.entity {
  cursor: help;
}

.namespace {
  opacity: .7;
}

@media screen and (max-width: 767px) {
  pre[class*="language-"]:before,
  pre[class*="language-"]:after {
    bottom: 14px;
    box-shadow: none;
  }

}

/* Plugin styles */
.token.tab:not(:empty):before,
.token.cr:before,
.token.lf:before {
  color: #e0d7d1;
}

/* Plugin styles: Line Numbers */
pre[class*="language-"].line-numbers.line-numbers {
  padding-left: 0;
}

pre[class*="language-"].line-numbers.line-numbers code {
  padding-left: 3.8em;
}

pre[class*="language-"].line-numbers.line-numbers .line-numbers-rows {
  left: 0;
}

/* Plugin styles: Line Highlight */
pre[class*="language-"][data-line] {
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 0;
}
pre[data-line] code {
  position: relative;
  padding-left: 4em;
}
pre .line-highlight {
  margin-top: 0;
}

pre[class*="language-"].line-numbers {
    position: relative;
    padding-left: 3.8em;
    counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
    position: relative;
    white-space: inherit;
}

.line-numbers .line-numbers-rows {
    position: absolute;
    pointer-events: none;
    top: 0;
    font-size: 100%;
    left: -3.8em;
    width: 3em; /* works for line-numbers below 1000 lines */
    letter-spacing: -1px;
    border-right: 1px solid #999;

    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

}

    .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }

        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }

</style>
  
    


</body>
</html>